{{ $agRoles := (include "remaping.aggregatedRoles" . | fromYaml) }}
{{- range $ocpRole, $apcRole := $agRoles }}
---
{{- if or (eq $ocpRole "admin") (eq $ocpRole "edit") (eq $ocpRole "view") }}
# workarkound for issue https://access.redhat.com/support/cases/#/case/04259235
aggregationRule:
  clusterRoleSelectors:
    - matchLabels:
        rbac.authorization.k8s.io/aggregate-to-{{ $ocpRole }}: 'true'
{{- end }}
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  annotations:
    argocd.argoproj.io/sync-options: ServerSideApply=true
  labels:
    {{- range $aggregateRole := $apcRole }}
    rbac.authorization.k8s.io/aggregate-to-{{ $aggregateRole }}: "true"
    {{- end }}
  name: {{ $ocpRole }}
{{- end }}