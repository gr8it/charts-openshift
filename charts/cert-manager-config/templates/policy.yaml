apiVersion: vault.vault.upbound.io/v1alpha1
kind: Policy
metadata:
  name: {{ include "apc-global-overrides.clusterName" . }}--{{ .Values.vaultKubeAuthRole }}
spec:
  forProvider:
    name: {{ include "apc-global-overrides.clusterName" . }}--{{ .Values.vaultKubeAuthRole }}
    ## https://github.com/cert-manager/cert-manager/issues/6150
    policy: |

      path "{{ .Values.vaultPkiPath }}/sign/{{ include "cert-manager-config.vaultPkiRole" . }}" {
        capabilities = ["create", "update"]
      }

      path "{{ .Values.vaultPkiPath }}/issue/{{ include "cert-manager-config.vaultPkiRole" . }}" {
        capabilities = ["create", "update"]
      }

  providerConfigRef:
    name: {{ include "apc-global-overrides.require-crossplaneKubeVaultProviderConfigName" . }}
