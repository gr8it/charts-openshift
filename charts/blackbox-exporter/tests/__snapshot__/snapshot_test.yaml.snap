manifests should match snapshot:
  1: |
    raw: |
      See https://github.com/prometheus/blackbox_exporter/ for how to configure Prometheus and the Blackbox Exporter.

      1. Get the application URL by running these commands:
        export POD_NAME=$(kubectl get pods --namespace apc-blackbox-exporter -l "app.kubernetes.io/name=prometheus-blackbox-exporter,app.kubernetes.io/instance=blackbox-exporter" -o jsonpath="{.items[0].metadata.name}")
        export CONTAINER_PORT=$(kubectl get pod --namespace apc-blackbox-exporter $POD_NAME -o jsonpath="{.spec.containers[0].ports[0].containerPort}")
        echo "Visit http://127.0.0.1:8080 to use your application"
        kubectl --namespace apc-blackbox-exporter port-forward $POD_NAME 8080:$CONTAINER_PORT
  2: |
    apiVersion: v1
    data:
      blackbox.yaml: |
        modules:
          http_2xx:
            http:
              follow_redirects: true
              method: GET
              no_follow_redirects: false
              preferred_ip_protocol: ip4
              tls_config:
                insecure_skip_verify: true
              valid_http_versions:
              - HTTP/1.0
              - HTTP/1.1
              - HTTP/2
              - HTTP/2.0
            prober: http
            timeout: 30s
          http_openshift_api:
            http:
              fail_if_body_not_matches_regexp:
              - ^ok
              method: GET
              no_follow_redirects: false
              preferred_ip_protocol: ip4
              tls_config:
                insecure_skip_verify: true
              valid_http_versions:
              - HTTP/2.0
              valid_status_codes:
              - 200
            prober: http
            timeout: 10s
          http_openshift_console:
            http:
              method: GET
              no_follow_redirects: false
              preferred_ip_protocol: ip4
              tls_config:
                insecure_skip_verify: true
              valid_http_versions:
              - HTTP/1.1
              - HTTP/2.0
              valid_status_codes:
              - 200
            prober: http
            timeout: 15s
          icmp:
            icmp:
              preferred_ip_protocol: ip4
            prober: icmp
            timeout: 5s
          tcp_probe:
            prober: tcp
            tcp:
              preferred_ip_protocol: ip4
            timeout: 10s
    kind: ConfigMap
    metadata:
      labels:
        app.kubernetes.io/instance: blackbox-exporter
        app.kubernetes.io/managed-by: Helm
        app.kubernetes.io/name: prometheus-blackbox-exporter
        app.kubernetes.io/version: v0.28.0
        helm.sh/chart: prometheus-blackbox-exporter-11.6.1
      name: blackbox-exporter-prometheus-blackbox-exporter
      namespace: apc-blackbox-exporter
  3: |
    apiVersion: apps/v1
    kind: Deployment
    metadata:
      labels:
        app.kubernetes.io/instance: blackbox-exporter
        app.kubernetes.io/managed-by: Helm
        app.kubernetes.io/name: prometheus-blackbox-exporter
        app.kubernetes.io/version: v0.28.0
        helm.sh/chart: prometheus-blackbox-exporter-11.6.1
      name: blackbox-exporter-prometheus-blackbox-exporter
      namespace: apc-blackbox-exporter
    spec:
      replicas: 2
      revisionHistoryLimit: 10
      selector:
        matchLabels:
          app.kubernetes.io/instance: blackbox-exporter
          app.kubernetes.io/name: prometheus-blackbox-exporter
      strategy:
        rollingUpdate:
          maxSurge: 1
          maxUnavailable: 0
        type: RollingUpdate
      template:
        metadata:
          annotations:
            checksum/config: 1742d991a67a8333b62fc24c6118f7d75c158658ff20c0da3602d6c948094363
          labels:
            app.kubernetes.io/instance: blackbox-exporter
            app.kubernetes.io/managed-by: Helm
            app.kubernetes.io/name: prometheus-blackbox-exporter
            app.kubernetes.io/version: v0.28.0
            helm.sh/chart: prometheus-blackbox-exporter-11.6.1
        spec:
          automountServiceAccountToken: false
          containers:
            - args:
                - --config.file=/config/blackbox.yaml
              envFrom:
                - configMapRef:
                    name: proxy
              image: quay.io/prometheus/blackbox-exporter:v0.28.0
              imagePullPolicy: IfNotPresent
              livenessProbe:
                failureThreshold: 3
                httpGet:
                  path: /-/healthy
                  port: http
              name: blackbox-exporter
              ports:
                - containerPort: 9115
                  name: http
              readinessProbe:
                httpGet:
                  path: /-/healthy
                  port: http
              securityContext:
                allowPrivilegeEscalation: false
                capabilities:
                  drop:
                    - ALL
                privileged: false
                readOnlyRootFilesystem: true
                runAsNonRoot: true
                seccompProfile:
                  type: RuntimeDefault
              volumeMounts:
                - mountPath: /config
                  name: config
          hostNetwork: false
          restartPolicy: Always
          securityContext:
            allowPrivilegeEscalation: false
            capabilities:
              drop:
                - ALL
            privileged: false
            readOnlyRootFilesystem: true
            runAsGroup: null
            runAsNonRoot: true
            runAsUser: null
            seccompProfile:
              type: RuntimeDefault
          serviceAccountName: blackbox-exporter-prometheus-blackbox-exporter
          volumes:
            - configMap:
                name: blackbox-exporter-prometheus-blackbox-exporter
              name: config
  4: |
    apiVersion: v1
    kind: clusterRole
    metadata:
      labels:
        rbac.authorization.k8s.io/aggregate-to-admin: "true"
        rbac.authorization.k8s.io/aggregate-to-edit: "true"
      name: blackbox-exporter-probe-edit
    rules:
      - apiGroups:
          - monitoring.coreos.com
        resources:
          - probes
        verbs:
          - get
          - list
          - watch
          - create
          - update
          - patch
          - delete
  5: |
    apiVersion: v1
    kind: clusterRole
    metadata:
      labels:
        rbac.authorization.k8s.io/aggregate-to-view: "true"
      name: blackbox-exporter-probe-view
    rules:
      - apiGroups:
          - monitoring.coreos.com
        resources:
          - probes
        verbs:
          - get
          - list
          - watch
  6: |
    apiVersion: monitoring.coreos.com/v1
    kind: PrometheusRule
    metadata:
      labels:
        app.kubernetes.io/instance: blackbox-exporter
        app.kubernetes.io/managed-by: Helm
        app.kubernetes.io/name: prometheus-blackbox-exporter
        app.kubernetes.io/version: v0.28.0
        helm.sh/chart: prometheus-blackbox-exporter-11.6.1
      name: blackbox-exporter-prometheus-blackbox-exporter
      namespace: apc-blackbox-exporter
    spec:
      groups:
        - name: prometheus-blackbox-exporter
          rules:
            - alert: Blackbox
              annotations:
                description: The Blackbox Exporter instance is not reachable. Please check the service and pod status.
                summary: Blackbox Exporter is down
              expr: up{job="blackbox-exporter-prometheus-blackbox-exporter"}== 0
              for: 5m
              labels:
                severity: warning
                team: platform
                vendor: aspecta
            - alert: Blackbox
              annotations:
                description: |-
                  Probe failed
                    VALUE = {{ $value }}
                    LABELS = {{ $labels }}
                summary: Blackbox probe failed (instance {{ $labels.instance }})
              expr: sum without (pod) (probe_success{namespace="apc-blackbox-exporter"} == 0)
              for: 0m
              labels:
                severity: warning
                team: platform
                vendor: aspecta
            - alert: Blackbox
              annotations:
                description: |-
                  Blackbox probe took more than 1s to complete
                    VALUE = {{ $value }}
                    LABELS = {{ $labels }}
                summary: Blackbox slow probe (instance {{ $labels.instance }})
              expr: avg without(pod) (avg_over_time(probe_duration_seconds[1m]) > 1) > 1
              for: 1m
              labels:
                severity: warning
                team: platform
                vendor: aspecta
            - alert: Blackbox
              annotations:
                description: |-
                  HTTP status code is not 200-399
                    VALUE = {{ $value }}
                    LABELS = {{ $labels }}
                summary: Blackbox probe HTTP failure (instance {{ $labels.instance }})
              expr: count without (pod) (probe_http_status_code <= 199 OR probe_http_status_code >= 400)  > 0
              for: 0m
              labels:
                severity: warning
                team: platform
                vendor: aspecta
            - alert: Blackbox
              annotations:
                description: |-
                  HTTP request took more than 1s
                    VALUE = {{ $value }}
                    LABELS = {{ $labels }}
                summary: Blackbox probe slow HTTP (instance {{ $labels.instance }})
              expr: avg without(pod) ( avg_over_time(probe_http_duration_seconds[1m]) > 1) > 1
              for: 1m
              labels:
                severity: warning
                team: platform
                vendor: aspecta
            - alert: Blackbox
              annotations:
                description: |-
                  Blackbox ping took more than 1s
                    VALUE = {{ $value }}
                    LABELS = {{ $labels }}
                summary: Blackbox probe slow ping (instance {{ $labels.instance }})
              expr: avg without(pod) ( avg_over_time(probe_icmp_duration_seconds[1m]) )> 1
              for: 1m
              labels:
                severity: warning
                team: platform
                vendor: aspecta
            - alert: Blackbox
              annotations:
                description: |-
                  Blackbox TCP took more than 1s
                    VALUE = {{ $value }}
                    LABELS = {{ $labels }}
                summary: Blackbox probe slow TCP (instance {{ $labels.instance }})
              expr: avg without(pod) ( avg_over_time(probe_tcp_duration_seconds[1m]) )> 1
              for: 1m
              labels:
                severity: warning
                team: platform
                vendor: aspecta
  7: |
    apiVersion: v1
    kind: Service
    metadata:
      labels:
        app.kubernetes.io/instance: blackbox-exporter
        app.kubernetes.io/managed-by: Helm
        app.kubernetes.io/name: prometheus-blackbox-exporter
        app.kubernetes.io/version: v0.28.0
        helm.sh/chart: prometheus-blackbox-exporter-11.6.1
      name: blackbox-exporter-prometheus-blackbox-exporter
      namespace: apc-blackbox-exporter
    spec:
      ports:
        - name: http
          port: 9115
          protocol: TCP
          targetPort: http
      selector:
        app.kubernetes.io/instance: blackbox-exporter
        app.kubernetes.io/name: prometheus-blackbox-exporter
      type: ClusterIP
  8: |
    apiVersion: v1
    kind: ServiceAccount
    metadata:
      labels:
        app.kubernetes.io/instance: blackbox-exporter
        app.kubernetes.io/managed-by: Helm
        app.kubernetes.io/name: prometheus-blackbox-exporter
        app.kubernetes.io/version: v0.28.0
        helm.sh/chart: prometheus-blackbox-exporter-11.6.1
      name: blackbox-exporter-prometheus-blackbox-exporter
      namespace: apc-blackbox-exporter
  9: |
    apiVersion: monitoring.coreos.com/v1
    kind: ServiceMonitor
    metadata:
      labels:
        app.kubernetes.io/instance: blackbox-exporter
        app.kubernetes.io/managed-by: Helm
        app.kubernetes.io/name: prometheus-blackbox-exporter
        app.kubernetes.io/version: v0.28.0
        component: openshift-console
        helm.sh/chart: prometheus-blackbox-exporter-11.6.1
        module: http_openshift_console
        team: platform
        vendor: aspecta
      name: blackbox-exporter-prometheus-blackbox-exporter-openshift-console
      namespace: apc-blackbox-exporter
    spec:
      endpoints:
        - honorTimestamps: true
          interval: 30s
          metricRelabelings:
            - action: replace
              replacement: https://console-openshift-console.apps.hub01.example.com/health
              sourceLabels:
                - instance
              targetLabel: instance
            - action: replace
              replacement: openshift-console
              sourceLabels:
                - target
              targetLabel: target
          params:
            module:
              - http_openshift_console
            target:
              - https://console-openshift-console.apps.hub01.example.com/health
          path: /probe
          port: http
          scheme: http
          scrapeTimeout: 30s
      jobLabel: blackbox-exporter
      namespaceSelector:
        matchNames:
          - apc-blackbox-exporter
      selector:
        matchLabels:
          app.kubernetes.io/instance: blackbox-exporter
          app.kubernetes.io/name: prometheus-blackbox-exporter
  10: |
    apiVersion: monitoring.coreos.com/v1
    kind: ServiceMonitor
    metadata:
      labels:
        app.kubernetes.io/instance: blackbox-exporter
        app.kubernetes.io/managed-by: Helm
        app.kubernetes.io/name: prometheus-blackbox-exporter
        app.kubernetes.io/version: v0.28.0
        component: openshift-api
        helm.sh/chart: prometheus-blackbox-exporter-11.6.1
        module: http_openshift_api
        team: platform
        vendor: aspecta
      name: blackbox-exporter-prometheus-blackbox-exporter-openshift-api
      namespace: apc-blackbox-exporter
    spec:
      endpoints:
        - honorTimestamps: true
          interval: 10s
          metricRelabelings:
            - action: replace
              replacement: https://api.hub01.example.com:6443/readyz
              sourceLabels:
                - instance
              targetLabel: instance
            - action: replace
              replacement: openshift-api
              sourceLabels:
                - target
              targetLabel: target
          params:
            module:
              - http_openshift_api
            target:
              - https://api.hub01.example.com:6443/readyz
          path: /probe
          port: http
          scheme: http
          scrapeTimeout: 10s
      jobLabel: blackbox-exporter
      namespaceSelector:
        matchNames:
          - apc-blackbox-exporter
      selector:
        matchLabels:
          app.kubernetes.io/instance: blackbox-exporter
          app.kubernetes.io/name: prometheus-blackbox-exporter
  11: |
    apiVersion: monitoring.coreos.com/v1
    kind: ServiceMonitor
    metadata:
      labels:
        app.kubernetes.io/instance: blackbox-exporter
        app.kubernetes.io/managed-by: Helm
        app.kubernetes.io/name: prometheus-blackbox-exporter
        app.kubernetes.io/version: v0.28.0
        component: xca
        helm.sh/chart: prometheus-blackbox-exporter-11.6.1
        module: http_2xx
        team: platform
        vendor: aspecta
      name: blackbox-exporter-prometheus-blackbox-exporter-hw-xca
      namespace: apc-blackbox-exporter
    spec:
      endpoints:
        - honorTimestamps: true
          interval: 10s
          metricRelabelings:
            - action: replace
              replacement: https://sr-ba-xapc1xca-p11.hw.example.com
              sourceLabels:
                - instance
              targetLabel: instance
            - action: replace
              replacement: hw-xca
              sourceLabels:
                - target
              targetLabel: target
          params:
            module:
              - http_2xx
            target:
              - https://sr-ba-xapc1xca-p11.hw.example.com
          path: /probe
          port: http
          scheme: http
          scrapeTimeout: 10s
      jobLabel: blackbox-exporter
      namespaceSelector:
        matchNames:
          - apc-blackbox-exporter
      selector:
        matchLabels:
          app.kubernetes.io/instance: blackbox-exporter
          app.kubernetes.io/name: prometheus-blackbox-exporter
  12: |
    apiVersion: monitoring.coreos.com/v1
    kind: ServiceMonitor
    metadata:
      labels:
        app.kubernetes.io/instance: blackbox-exporter
        app.kubernetes.io/managed-by: Helm
        app.kubernetes.io/name: prometheus-blackbox-exporter
        app.kubernetes.io/version: v0.28.0
        component: gitlab-webui
        helm.sh/chart: prometheus-blackbox-exporter-11.6.1
        module: http_2xx
        team: platform
        vendor: aspecta
      name: blackbox-exporter-prometheus-blackbox-exporter-gitlab-webui
      namespace: apc-blackbox-exporter
    spec:
      endpoints:
        - honorTimestamps: true
          interval: 10s
          metricRelabelings:
            - action: replace
              replacement: https://git.apps.hub01.example.com
              sourceLabels:
                - instance
              targetLabel: instance
            - action: replace
              replacement: gitlab-webui
              sourceLabels:
                - target
              targetLabel: target
          params:
            module:
              - http_2xx
            target:
              - https://git.apps.hub01.example.com
          path: /probe
          port: http
          scheme: http
          scrapeTimeout: 10s
      jobLabel: blackbox-exporter
      namespaceSelector:
        matchNames:
          - apc-blackbox-exporter
      selector:
        matchLabels:
          app.kubernetes.io/instance: blackbox-exporter
          app.kubernetes.io/name: prometheus-blackbox-exporter
  13: |
    apiVersion: networking.k8s.io/v1
    kind: NetworkPolicy
    metadata:
      labels:
        app.kubernetes.io/instance: blackbox-exporter
        app.kubernetes.io/managed-by: Helm
        app.kubernetes.io/name: blackbox-exporter
        app.kubernetes.io/version: 11.6.1
        helm.sh/chart: blackbox-exporter-1.0.0
      name: blackbox-exporter-egress-allow-proxy
      namespace: apc-blackbox-exporter
    spec:
      egress:
        - to:
            - ipBlock:
                cidr: 1.1.1.7/32
      podSelector: {}
      policyTypes:
        - Egress
