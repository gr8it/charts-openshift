apiVersion: vault.vault.upbound.io/v1alpha1
kind: Policy
metadata:
  name: {{ include "external-secrets-config.policyName" . }}
spec:
  forProvider:
    name: {{ include "external-secrets-config.policyName" . }}
    ## https://github.com/cert-manager/cert-manager/issues/6150
    # delete omited by design not to allow deletion of secrets => allow creation, updates, and reads
    policy: |

      path "{{ include "apc-global-overrides.require-vaultKVmountPlatform" . }}/{{ include "apc-global-overrides.environmentShort" . }}/*" {
        capabilities = ["create", "read", "update", "patch", "list"]
      }
      path "{{ include "apc-global-overrides.require-vaultKVmountPlatform" . }}/data/{{ include "apc-global-overrides.environmentShort" . }}/*" {
        capabilities = ["create", "read", "update", "patch", "list"]
      }
      path "{{ include "apc-global-overrides.require-vaultKVmountPlatform" . }}/metadata/{{ include "apc-global-overrides.environmentShort" . }}/*" {
        capabilities = ["create", "read", "update", "patch", "list"]
      }

  providerConfigRef:
    name: {{ include "apc-global-overrides.require-crossplaneKubeVaultProviderConfigName" . }}
