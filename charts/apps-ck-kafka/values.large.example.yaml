global:
  apc:
    cluster:
      appsDomain: apps.test.example.com
    services:
      certManager:
        defaultClusterIssuer: vault-issuer

kafka:
  brokers:
    replicas: 5  # 5-node cluster for higher throughput
    storage:
      size: "500Gi"  # Larger disks
    resources:
      requests:
        cpu: "2000m"
        memory: "4Gi"
      limits:
        cpu: "4000m"
        memory: "8Gi"

  # Additional listeners for external access
  # NOTE: This requires extending kafka-singlenode.yaml template to add these listeners
  # Example listeners configuration:
  externalAccess:
    enabled: true
    type: loadbalancer
    bootstrap:
      host: kafka.example.com
      port: 9094
    brokers:
    - host: kafka-0.example.com
      port: 9094
    - host: kafka-1.example.com
      port: 9094
    - host: kafka-2.example.com
      port: 9094
  
  listeners:
    - name: external
      port: 9094
      type: loadbalancer
      tls: true
      authentication:
        type: scram-sha-512
      configuration:
        brokerCertChainAndKey:
          secretName: kafka-brokers
          certificate: tls.crt
          key: tls.key
        bootstrap:
          host: kafka.example.com       # External DNS
          port: 9094
        brokers:
          - broker: 0
            host: kafka-0.example.com
            port: 9094
          - broker: 1
            host: kafka-1.example.com
            port: 9094
          - broker: 2
            host: kafka-2.example.com
            port: 9094

  controllers:
    replicas: 5  # 5-node controller quorum for resilience
    storage:
      size: "50Gi"
    resources:
      requests:
        cpu: "1000m"
        memory: "2Gi"
      limits:
        cpu: "2000m"
        memory: "4Gi"

  superUsers:
    - admin

  config:
    offsetsReplicationFactor: 3
    offsetsPartitions: 100
    transactionReplicationFactor: 3
    transactionMinISR: 2
    transactionPartitions: 100
    defaultReplicationFactor: 3
    minISR: 2
    defaultPartitions: 10  # More partitions by default for parallelism
    logRetentionHours: 336  # 14 days retention
    numNetworkThreads: 16
    numIOThreads: 16
    socketSendBufferBytes: 524288
    socketReceiveBufferBytes: 524288

monitoring:
  scrapeInterval: "30s"  # More frequent scraping
  alerts:
    minBrokersUp: 3
    consumerLagThreshold: 500000  # Higher threshold for large volumes

kafkaUsers:
  enabled: true
  users:
    - name: app-producer-high-volume
      acls:
        - resourceType: topic
          resourceName: "*"
          patternType: Prefix
          operations: [Write, Create, Describe]
    
    - name: app-consumer-analytics
      acls:
        - resourceType: topic
          resourceName: "*"
          patternType: Prefix
          operations: [Read, Describe]
        - resourceType: group
          resourceName: "*"
          patternType: Prefix
          operations: [Read]
    
    - name: platform-admin
      acls:
        - resourceType: "*"
          resourceName: "*"
          patternType: literal
          operations: [All]

    - name: admin

networkpolicy:
  enabled: true
  namespaces:
  - source-namespace-1
  - source-namespace-2

kafka-ui:
  enabled: true

  envs:
    config:
      KAFKA_CLUSTERS_0_NAME: kafka
      KAFKA_CLUSTERS_0_BOOTSTRAPSERVERS: kafka-kafka-bootstrap.kafka.svc:9093
      KAFKA_CLUSTERS_0_SSL_VERIFYSSL: "false"
      KAFKA_CLUSTERS_0_PROPERTIES_SASL_MECHANISM: SCRAM-SHA-512
      KAFKA_CLUSTERS_0_PROPERTIES_SECURITY_PROTOCOL: SASL_SSL
      # https://github.com/kafbat/kafka-ui/discussions/1260#discussioncomment-14275371
      KAFKA_CLUSTERS_0_SSL_TRUSTSTORELOCATION: "/etc/kafka/cluster-ca/ca-bundle.jks"
      KAFKA_CLUSTERS_0_SSL_TRUSTSTORE_TYPE: JKS
      KAFKA_CLUSTERS_0_SSL_TRUSTSTOREPASSWORD: "changeit"
      # KAFKA_CLUSTERS_0_METRICS_SSL: "false"
      # KAFKA_CLUSTERS_0_METRICS_PORT: "9404"
      # KAFKA_CLUSTERS_0_METRICS_TYPE: PROMETHEUS

      # https://github.com/kafbat/kafka-ui/issues/759#issuecomment-2615337590
      JAVA_OPTS: -Djavax.net.ssl.trustStore=/etc/kafka/cluster-ca/ca-bundle.jks -Djavax.net.ssl.trustStorePassword=changeit

    secretMappings:
      KAFKA_CLUSTERS_0_PROPERTIES_SASL_JAAS_CONFIG:
        name: admin
        keyName: sasl.jaas.config
      AUTH_OAUTH2_CLIENT_OPENSHIFT_CLIENT_ID:
        name: openshift-oauth-client-secret
        keyName: client-id
      AUTH_OAUTH2_CLIENT_OPENSHIFT_CLIENT_SECRET:
        name: openshift-oauth-client-secret
        keyName: client-secret

  ## requires version 1.5, or a nightly version newer than 1.4 - https://github.com/kafbat/kafka-ui/pull/1636 => po upgrade na v1.5 vyskusat
  yamlApplicationConfig:
    auth:
      type: OAUTH2
      oauth2:
        client:
          openshift:
            ## read from secret using mapping
            # clientId:
            # clientSecret:
            scope: openid
            client-name: Openshift OAUTH # will be displayed on the login page
            provider: oauth
            redirect-uri: https://ck-kafka-kafka-ui-ck-kafka.apps.example/com/login/oauth2/code/oauth
            authorization-grant-type: authorization_code
            issuer-uri: https://openshift.default.svc/.well-known/oauth-authorization-server
            authorization-uri: https://oauth.dev01.cloud.socpoist.sk:30302/oauth/authorize
            token-uri: https://oauth.dev01.cloud.socpoist.sk:30302/oauth/token
            # openshift oauth server has no user info endpoint = can't be used for authentication!!!
            user-info-uri: http(s)://HOSTNAME/api/v3/user
            user-name-attribute: preferred_username
            custom-params:
              type: oauth
              roles-field: groups

    rbac:
      roles:
        - name: "admins"
          subjects:
            - provider: oauth
              type: role
              value: ".*-ADMIN"
              regex: true
            - provider: oauth
              type: role
              value: "ocp_admins_dev"
