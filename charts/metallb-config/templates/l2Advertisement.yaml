{{- $environment := include "apc-global-overrides.environment" . }}
{{- if ne $environment "hub" }}
apiVersion: metallb.io/v1beta1
kind: L2Advertisement
metadata:
  name: ingress
  namespace: {{ .Values.metallbns }}
  labels:
    {{- include "metallb-config.labels" . | nindent 4 }}
spec:
  ipAddressPools:
  - ingress-reserved
  interfaces:
  - {{ .Values.metallbInterface }}
---
{{- end }}
{{- if eq $environment "hub" }}
{{- range $env, $ipAddrPool := .Values.ipAddrPool.hub }}
apiVersion: metallb.io/v1beta1
kind: L2Advertisement
metadata:
  name: kubeapi-{{ $env }}01
  namespace: metallb-system
  labels:
    {{- include "metallb-config.labels" $ | nindent 4 }}
spec:
  ipAddressPools:
  - kubeapi-{{ $env }}01
  interfaces:
  - {{ .Values.metallbInterface }}
---
{{- end }}
{{- end }}