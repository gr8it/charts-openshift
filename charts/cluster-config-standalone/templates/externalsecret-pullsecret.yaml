{{- if .Values.pullSecret.enabled }}
apiVersion: external-secrets.io/v1beta1
kind: ExternalSecret
metadata:
  name: pull-secret
  namespace: openshift-config
  labels:
    {{- include "cluster-config-standalone.labels" . | nindent 4 }}
spec:
  refreshInterval: 1h # default 1h
  secretStoreRef:
    name: {{ include "apc-global-overrides.require-ESODefaultClusterSecretStore" . }}
    kind: ClusterSecretStore
  target:
    name: pull-secret
    creationPolicy: Owner
    template:
      type: kubernetes.io/dockerconfigjson
      data:
        ".dockerconfigjson": "{{`{{ .pullsecret | toString }}`}}"
  data:
  - secretKey: pullsecret
    remoteRef:
      key: {{ include "apc-global-overrides.require-vaultKVmountPlatform" . }}/{{ include "apc-global-overrides.require-environmentShort" . }}/{{ .Values.pullSecret.vaultKey }}
      property: {{ .Values.pullSecret.vaultProperty }}
{{- end }}
