# # mongodb & avro connector
# FROM confluentinc/cp-kafka-connect:6.2.0 as cp
# RUN confluent-hub install --no-prompt mongodb/kafka-connect-mongodb:1.6.1
# RUN confluent-hub install --no-prompt confluentinc/kafka-connect-avro-converter:6.2.0
# FROM quay.io/strimzi/kafka:latest-kafka-3.0.0
# USER root:root
# RUN mkdir -p /opt/kafka/plugins/kafka-connect-mongodb
# COPY --from=cp /usr/share/confluent-hub-components/mongodb-kafka-connect-mongodb/lib /opt/kafka/plugins/mongodb/
# COPY --from=cp /usr/share/confluent-hub-components/confluentinc-kafka-connect-avro-converter/lib /opt/kafka/plugins/mongodb/
# USER 1001

## snowflage & avro connector
# FROM confluentinc/cp-kafka-connect:6.2.0 as cp
# RUN confluent-hub install --no-prompt snowflakeinc/snowflake-kafka-connector:1.5.5 \
#   && confluent-hub install --no-prompt confluentinc/kafka-connect-avro-converter:6.2.0
# FROM quay.io/strimzi/kafka:0.25.0-kafka-2.8.0
# USER root:root
# RUN mkdir -p /opt/kafka/plugins/snowflake && mkdir -p /opt/kafka/plugins/avro/
# COPY --from=cp /usr/share/confluent-hub-components/snowflakeinc-snowflake-kafka-connector/lib /opt/kafka/plugins/snowflake/
# COPY --from=cp /usr/share/confluent-hub-components/confluentinc-kafka-connect-avro-converter/lib /opt/kafka/plugins/avro/
# USER 1001

FROM quay.io/strimzi/kafka:latest-kafka-4.0.1-amd64

ARG KAFKA_HOME=/opt/kafka

USER root:root
# RUN mkdir -p /opt/kafka/plugins/ && \
#     curl -o /tmp/connector.tar.gz https://repo1.maven.org/maven2/org/apache/camel/kafkaconnector/camel-ceph-sink-kafka-connector/4.14.0/camel-ceph-sink-kafka-connector-4.14.0-package.tar.gz && \
#     tar -xzf /tmp/connector.tar.gz --directory=/tmp && \
#     mv /tmp/camel-ceph-sink-kafka-connector/* /opt/kafka/plugins/ && \
#     rm -rf /tmp/* && \
#     curl -o /opt/kafka/plugins/connect-json-4.0.1.jar https://repo1.maven.org/maven2/org/apache/kafka/connect-json/4.0.1/connect-json-4.0.1.jar

# RUN mkdir -p /opt/kafka/plugins/camel-ceph-sink-kafka-connector/ && \
#     curl -o /tmp/connector.tar.gz https://repo1.maven.org/maven2/org/apache/camel/kafkaconnector/camel-ceph-sink-kafka-connector/4.14.0/camel-ceph-sink-kafka-connector-4.14.0-package.tar.gz && \
#     tar -xzf /tmp/connector.tar.gz --directory=/tmp && \
#     mv /tmp/camel-ceph-sink-kafka-connector/* /opt/kafka/plugins/camel-ceph-sink-kafka-connector/ && \
#     rm -rf /tmp/*

# RUN mkdir -p /opt/kafka/plugins/camel-aws-s3-sink-kafka-connector/ && \
#     curl -o /tmp/connector.tar.gz https://repo.maven.apache.org/maven2/org/apache/camel/kafkaconnector/camel-aws-s3-sink-kafka-connector/4.10.3/camel-aws-s3-sink-kafka-connector-4.10.3-package.tar.gz && \
#     tar -xzf /tmp/connector.tar.gz --directory=/tmp && \
#     mv /tmp/camel-aws-s3-sink-kafka-connector/* /opt/kafka/plugins/camel-aws-s3-sink-kafka-connector/ && \
#     rm -rf /tmp/*

# RUN mkdir -p /opt/kafka/plugins/camel-ceph-sink-kafka-connector/ && \
#     curl -o /tmp/connector.tar.gz https://repo1.maven.org/maven2/org/apache/camel/kafkaconnector/camel-ceph-sink-kafka-connector/4.14.0/camel-ceph-sink-kafka-connector-4.14.0-package.tar.gz && \
#     tar -xzf /tmp/connector.tar.gz --directory=/tmp && \
#     mv /tmp/camel-ceph-sink-kafka-connector/* /opt/kafka/plugins/camel-ceph-sink-kafka-connector/ && \
#     rm -rf /tmp/*

RUN mkdir -p /opt/kafka/plugins/

RUN curl -o /tmp/connector.zip https://hub-downloads.confluent.io/api/plugins/confluentinc/kafka-connect-s3/versions/11.0.8/confluentinc-kafka-connect-s3-11.0.8.zip && \
unzip /tmp/connector.zip -d /opt/kafka/plugins/ && \
rm -rf /tmp/*

# RUN curl -L -o /tmp/hub-client.tar.gz http://client.hub.confluent.io/confluent-hub-client-latest.tar.gz && \
#     tar -xvf /tmp/hub-client.tar.gz -C /opt/kafka/ && \
#     rm -rf /tmp/hub-client.tar.gz

# # version 7.6.0 contains io.confluent.kafka.schemaregistry.utils.BoundedConcurrentHashMap class
# RUN curl -L -o /opt/kafka/plugins/kafka-connect-avro-converter-7.6.8.jar https://packages.confluent.io/maven/io/confluent/kafka-connect-avro-converter/7.6.8/kafka-connect-avro-converter-7.6.8.jar

# RUN /opt/kafka/bin/confluent-hub install --no-prompt confluentinc/kafka-connect-s3:11.0.0 \
#     --component-dir /opt/kafka/plugins

# # version 7.6.0 contains io.confluent.kafka.schemaregistry.utils.BoundedConcurrentHashMap class
# RUN /opt/kafka/bin/confluent-hub install --no-prompt confluentinc/kafka-connect-avro-converter:7.6.0 \
#     --component-dir /opt/kafka/plugins

# RUN cp ${KAFKA_HOME}/libs/json-utils-*.jar ${KAFKA_HOME}/plugins/ && \
#     cp ${KAFKA_HOME}/libs/json-*.jar ${KAFKA_HOME}/plugins/ && \
#     cp ${KAFKA_HOME}/libs/camel-util-json-*.jar ${KAFKA_HOME}/plugins/
USER 1001
